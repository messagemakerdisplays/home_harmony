<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zen & Boss Ledger (60/40)</title>

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0b0f19" />

  <style>
    :root{ font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color-scheme: dark; }
    body{
      margin:0; padding:16px;
      background: radial-gradient(1200px 600px at 20% 0%, #182243 0%, #0b0f19 55%, #060812 100%);
      color:#e8eefc;
    }
    .card{
      background: rgba(14, 18, 33, .75);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 10px 35px rgba(0,0,0,.45);
      margin-bottom: 12px;
    }
    h1{ font-size: 20px; margin: 0 0 6px; }
    .sub{ color: rgba(232,238,252,.78); font-size: 13px; line-height: 1.35; }
    .tiny{ font-size: 12px; color: rgba(232,238,252,.68); }
    .big{ font-size: 18px; font-weight: 800; }
    .ok{ color:#59d185; }
    .warn{ color:#ff6b6b; }

    label{ display:block; font-size: 13px; margin: 10px 0 6px; }
    input, select{
      width:100%; padding:10px; border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color:#e8eefc; font-size:15px;
    }

    button{
      width:100%; padding:12px; border:0; border-radius:16px;
      font-size:16px; cursor:pointer;
      box-shadow:0 12px 22px rgba(0,0,0,.35);
    }
    .btn{ background: linear-gradient(135deg,#2b6cff,#1f5eff); color:#fff; }
    .btn2{ background: rgba(255,255,255,.12); color:#fff; margin-top:8px; }
    .btn3{ background: linear-gradient(135deg,#22c55e,#0b7a2a); color:#05130a; margin-top:8px; }
    .btn4{ background: linear-gradient(135deg,#ff8a3d,#9a3e00); color:#160800; margin-top:8px; }

    .grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .row{ display:flex; gap:10px; }
    .row > div{ flex:1; }

    table{ width:100%; border-collapse:collapse; font-size:13px; }
    th,td{ padding:8px; border-bottom:1px solid rgba(255,255,255,.08); }

    .pill{ padding:2px 8px; border-radius:999px; font-size:12px; }
    .z{ background:#3b82f61f; color:#b8d6ff; }
    .b{ background:#f973161f; color:#ffd2b3; }

    .toast{
      position:fixed; left:50%; bottom:18px;
      transform:translateX(-50%) translateY(30px);
      background:#0c1020; padding:10px 12px;
      border-radius:14px; opacity:0;
      transition:.25s;
    }
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(0); }
  </style>
</head>
<body>

<div class="card">
  <h1>ğŸŒ™ Zen & Boss Ledger</h1>
  <div class="sub">ğŸ§˜â€â™‚ï¸ Zen 60% â€¢ ğŸ”¥ Boss 40% â€¢ Shared sanity via iCloud JSON</div>
  <div class="tiny">On open, youâ€™ll be prompted to load the latest iCloud file.</div>
</div>

<div class="card">
  <label>ğŸ’¸ Amount</label>
  <input id="amount" type="number" step="0.01" />

  <label>ğŸ‘¤ Paid By</label>
  <select id="paidBy">
    <option value="Z">ğŸ§˜â€â™‚ï¸ Zen</option>
    <option value="B">ğŸ”¥ Boss</option>
  </select>

  <button class="btn" onclick="addExpense()">â• Add Expense</button>

  <div class="grid">
    <button class="btn3" onclick="exportToIcloud()">ğŸ’¾ Save iCloud</button>
    <button class="btn4" onclick="importFromIcloud()">ğŸ“‚ Load iCloud</button>
  </div>
</div>

<div class="card">
  <div class="big" id="verdict">â€”</div>
</div>

<div class="toast" id="toast"></div>

<script>
const STORAGE_KEY = "zen_boss_data";
const META_KEY = "zen_boss_meta";
let expenses = [];

const gbp = n => "Â£" + Number(n).toFixed(2);
const $ = id => document.getElementById(id);

function showToast(t){
  const el = $("toast");
  el.textContent = t;
  el.classList.add("show");
  setTimeout(()=>el.classList.remove("show"),2000);
}

function loadLocal(){
  try{ expenses = JSON.parse(localStorage.getItem(STORAGE_KEY))||[]; }catch{ expenses=[]; }
}
function saveLocal(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(expenses)); }

function loadMeta(){
  try{ return JSON.parse(localStorage.getItem(META_KEY))||{}; }catch{ return {}; }
}
function saveMeta(m){ localStorage.setItem(META_KEY, JSON.stringify(m)); }

function addExpense(){
  const a = Number($("amount").value);
  const p = $("paidBy").value;
  if(!a) return showToast("Enter an amount");
  expenses.push({amount:a, paidBy:p});
  saveLocal();
  $("amount").value="";
  recalc();
  showToast("Expense added");
}

function recalc(){
  const total = expenses.reduce((s,e)=>s+e.amount,0);
  const zenPaid = expenses.filter(e=>e.paidBy==="Z").reduce((s,e)=>s+e.amount,0);
  const zenShould = total*0.6;
  const net = zenPaid-zenShould;
  if(Math.abs(net)<0.01) $("verdict").textContent="âœ… Even Steven";
  else if(net<0) $("verdict").textContent=`ğŸ§˜â€â™‚ï¸ Zen owes ğŸ”¥ Boss ${gbp(-net)}`;
  else $("verdict").textContent=`ğŸ”¥ Boss owes ğŸ§˜â€â™‚ï¸ Zen ${gbp(net)}`;
}

function exportToIcloud(){
  const blob = new Blob([JSON.stringify({expenses},null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="zen-boss-ledger.json";
  a.click();
  URL.revokeObjectURL(a.href);
  const m=loadMeta(); m.lastIcloudLoadAt=Date.now(); saveMeta(m);
}

function importFromIcloud(){
  const i=document.createElement("input");
  i.type="file"; i.accept="application/json";
  i.onchange=()=>{
    const f=i.files[0]; if(!f) return;
    const r=new FileReader();
    r.onload=()=>{
      try{
        const d=JSON.parse(r.result);
        expenses=d.expenses||[];
        saveLocal();
        const m=loadMeta(); m.lastIcloudLoadAt=Date.now(); saveMeta(m);
        recalc();
        showToast("Loaded from iCloud");
      }catch{ showToast("Invalid file"); }
    };
    r.readAsText(f);
  };
  i.click();
}

function shouldPromptLoad(){
  const m=loadMeta();
  if(!expenses.length) return true;
  if(!m.lastIcloudLoadAt) return true;
  return (Date.now()-m.lastIcloudLoadAt) > 6*60*60*1000;
}

loadLocal();
recalc();

setTimeout(()=>{
  if(shouldPromptLoad()){
    if(confirm("Load latest iCloud JSON to get upâ€‘toâ€‘date entries?")){
      importFromIcloud();
    }
  }
},400);
</script>
</body>
</html>
